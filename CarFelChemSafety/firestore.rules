rules_version = '2';

// ============================================================
// FIRESTORE RULES - DEBUG MODE
// Projeto: CarFel ChemSafety (carfel-chemsafety)
// ============================================================
//
// ⚠️  ATENÇÃO: Estas regras são para DESENVOLVIMENTO/DEBUG.
//     NÃO usar em produção sem restringir os acessos.
//
// Para produção, substituir pelas regras comentadas abaixo
// na seção "REGRAS DE PRODUÇÃO".
// ============================================================

service cloud.firestore {
  match /databases/{database}/documents {

    // -------------------------------------------------------
    // DEBUG: Permite leitura e escrita total para qualquer
    // usuário autenticado. Útil para testar queries e
    // depurar problemas de permissão.
    // -------------------------------------------------------

    // Coleção "users" — perfis de utilizador
    match /users/{userId} {
      // Qualquer utilizador autenticado pode ler qualquer perfil
      allow read: if request.auth != null;

      // Qualquer utilizador autenticado pode criar/editar perfis
      allow write: if request.auth != null;
    }

    // Catch-all: qualquer outra coleção futura
    // (remover em produção!)
    match /{document=**} {
      allow read, write: if request.auth != null;
    }

    // -------------------------------------------------------
    // REGRAS DE PRODUÇÃO (descomentar quando estiver pronto)
    // -------------------------------------------------------
    //
    // match /users/{userId} {
    //   // Leitura: apenas o próprio utilizador ou queries
    //   // por username/email (necessário para login)
    //   allow read: if request.auth != null;
    //
    //   // Criação: apenas se o userId corresponder ao UID
    //   // do utilizador autenticado
    //   allow create: if request.auth != null
    //                 && request.auth.uid == userId
    //                 && request.resource.data.keys().hasAll(['id', 'username', 'email', 'createdAt'])
    //                 && request.resource.data.id == request.auth.uid
    //                 && request.resource.data.username is string
    //                 && request.resource.data.username.size() >= 3
    //                 && request.resource.data.email is string
    //                 && request.resource.data.createdAt is number;
    //
    //   // Atualização: apenas o próprio utilizador,
    //   // e não pode alterar id ou createdAt
    //   allow update: if request.auth != null
    //                 && request.auth.uid == userId
    //                 && request.resource.data.id == resource.data.id
    //                 && request.resource.data.createdAt == resource.data.createdAt;
    //
    //   // Exclusão: apenas o próprio utilizador
    //   allow delete: if request.auth != null
    //                 && request.auth.uid == userId;
    // }
  }
}
